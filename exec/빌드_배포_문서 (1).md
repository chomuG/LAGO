# GitLab 소스 클론 이후 빌드 및 배포 문서

## 1. 사용한 JVM, 서버, 웹서버, WAS 제품 등의 종류와 설정 값, 버전

### 1.1 JVM 및 언어 환경
- **Java**: OpenJDK 21 (Eclipse Temurin)
- **언어 버전**: Java 21 LTS
- **JVM 특성**: Virtual Threads 활성화 (`spring.threads.virtual.enabled=true`)

### 1.2 빌드 도구
- **Gradle**: 8.14.3
- **Gradle Wrapper**: 사용 (`gradle/wrapper/gradle-wrapper.properties`)

### 1.3 백엔드 프레임워크 및 라이브러리
- **Spring Boot**: 3.5.4
- **Spring Framework**: Spring Data JPA, Spring WebSocket, Spring Security, Spring Actuator
- **웹 서버**: 내장 Tomcat (Spring Boot Embedded)
- **포트**: 9000 (컨테이너 내부), 8081 (외부 노출)

### 1.4 데이터베이스
- **PostgreSQL/TimescaleDB**: timescale/timescaledb-ha:pg14-latest
- **연결 풀**: HikariCP
  - 개발환경: maximum-pool-size=5
  - 운영환경: maximum-pool-size=10, minimum-idle=2

### 1.5 캐시 및 메시징
- **Redis**: 7.2
- **포트**: 6379
- **용도**: 캐싱, 실시간 데이터 스트림 (`orders-stream`)

### 1.6 마이크로서비스
- **Chart Analysis Service**: Python 3.9-slim-buster 기반 FastAPI
- **포트**: 8000 (컨테이너 내부), 5001 (외부 노출)
- **의존성**: Flask 2.2.5, pandas 1.3.5, numpy 1.24.4, plotly 5.18.0

### 1.7 컨테이너 환경
- **Docker**: Docker Compose 기반 멀티 서비스
- **Base Image**: 
  - Backend: eclipse-temurin:21-jdk-jammy
  - Chart Analysis: python:3.9-slim-buster
  - TimescaleDB: timescale/timescaledb-ha:pg14-latest
  - Redis: redis:7.2

### 1.8 IDE 및 개발 도구
- **API 문서**: Swagger UI (`springdoc-openapi-starter-webmvc-ui:2.8.9`)
- **디버깅**: Spring Boot DevTools
- **테스트**: JUnit 5, TestContainers

## 2. 빌드시 사용되는 환경 변수 등의 내용 상세

### 2.1 필수 환경 변수 (.env 파일)

#### 데이터베이스 설정
```bash
POSTGRES_DB=stock_db
POSTGRES_USER=ssafyuser
POSTGRES_PASSWORD=ssafypw!!
SPRING_DATASOURCE_URL=jdbc:postgresql://i13d203.p.ssafy.io:5432/stock_db
SPRING_DATASOURCE_USERNAME=ssafyuser
SPRING_DATASOURCE_PASSWORD=ssafypw!!
```

#### Spring Boot 프로파일
```bash
SPRING_PROFILES_ACTIVE=prod  # 또는 dev
SPRING_JPA_HIBERNATE_DDL_AUTO=none
SPRING_JPA_SHOW_SQL=true
```

#### Redis 설정
```bash
SPRING_REDIS_HOST=redis
SPRING_REDIS_PORT=6379
REDIS_STREAM_KEY=orders-stream
REDIS_STREAM_CONSUMER_GROUP=lago_group
REDIS_STREAM_CONSUMER_NAME=lago_consumer
```

#### OAuth2 소셜 인증
```bash
# Google OAuth2
GOOGLE_CLIENT_ID=872605543976-dcasbhgbmsf3j4821ntsed50267dlpqr.apps.googleusercontent.com
GOOGLE_CLIENT_SECRET=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
GOOGLE_REDIRECT_URI=http://localhost:8081/oauth2/callback/google

# Kakao OAuth2
KAKAO_CLIENT_ID=a7471cf356e26d8fa4b117381feebfd3
KAKAO_CLIENT_SECRET=Q0OzPazbOFuYbb1Cg2qLHQDkytKaYcaa
KAKAO_REDIRECT_URI=http://localhost:8081/oauth2/callback/kakao
```

#### KIS API 인증
```bash
APP_KEY_A=PSXLaNAHtahIBQwCFTBJNGczBiVStg891SM4
APP_SECRET_A=0GEAdZOqIFNYJaMz3wm33XxpCcU5Xa7wDdAJZ8DzH0vK+mtRVX0AlhRFXcKw7t2UzNL8ldEwYYCSpGKMrah0ASzeLM4xvC4VuIvmdD+WfsuDC7jVYFSakytwIk6nXv+0jCJATUSHv/gQlhKpqKekP3pmwgzyp9tAcBcwo6Kuemz0lOhxYL0=
APP_KEY_B=PSs28ViZ7UQIjQsIOOAA5VV4mm0p88OnfCMA
APP_SECRET_B=G7H/UQho1+8VPP5OP4Fw9eIt5MgbyS6Tn5xmSrWDdOZGTQ9pg7BVNZG19zCw6ajea3tLLNR7rcwwtiFllsQKtiUjEBzxGb2RA6REedzIRF8DETU+Ytxt3x4sqSwY1W/oZAXm521kIE1M49xguvMxfUfoQwvykZyj3xW0HTahfE0W/3A+MIU=
```

#### FinBERT 서비스
```bash
FINBERT_SERVER_HOST=http://finbert:5000
FINBERT_CLIENT_TIMEOUT=15000
```

#### 기타 설정
```bash
LOG_LEVEL=INFO
DOCKER_GID=999
```

### 2.2 빌드 명령어

#### 로컬 개발 빌드
```bash
cd BE
./gradlew clean build
./gradlew bootRun  # .env 파일 자동 로드
```

#### Docker 기반 빌드
```bash
# 전체 서비스 빌드 및 시작
docker-compose up -d --build

# 개별 서비스 빌드
docker-compose build --no-cache backend
docker-compose build --no-cache chart-analysis
```

## 3. 배포 시 특이사항

### 3.1 멀티 서비스 아키텍처
- **총 4개 서비스**: Backend, TimescaleDB, Redis, Chart Analysis
- **서비스 의존성**: Backend → TimescaleDB (헬스체크), Redis, Chart Analysis

### 3.2 포트 매핑
- Backend: 8081:9000
- TimescaleDB: 5432:5432
- Redis: 6379:6379
- Chart Analysis: 5001:8000

### 3.3 데이터 영속성
- **TimescaleDB 데이터**: `timescale_data` Docker Volume 사용
- **데이터 경로**: `/home/postgres/pgdata/data`

### 3.4 헬스체크 설정
```yaml
# TimescaleDB
healthcheck:
  test: ["CMD-SHELL", "pg_isready -U ${POSTGRES_USER} -d ${POSTGRES_DB} || exit 1"]
  interval: 5s
  timeout: 3s
  retries: 30

# Chart Analysis
healthcheck:
  test: ["CMD-SHELL", "curl -f http://localhost:8000/health || exit 1"]
  interval: 30s
  timeout: 10s
  retries: 3
```

### 3.5 프로파일 기반 설정
- **개발환경 (dev)**: 상세 로깅, Swagger UI 활성화, Mock 데이터
- **운영환경 (prod)**: 최소 로깅, 보안 강화, 성능 최적화

### 3.6 Firebase 설정
- **서비스 계정 키**: `firebaseServiceAccountKey.json` 파일 필요
- **위치**: BE/ 디렉토리 루트

## 4. DB 접속 정보 등 프로젝트(ERD)에 활용되는 주요 계정 및 프로퍼티가 정의된 파일 목록

### 4.1 데이터베이스 접속 정보
- **호스트**: i13d203.p.ssafy.io
- **포트**: 5432
- **데이터베이스명**: stock_db
- **사용자명**: ssafyuser
- **비밀번호**: ssafypw!!
- **타입**: PostgreSQL with TimescaleDB extension

### 4.2 프로퍼티 파일 목록

#### 주요 설정 파일
1. **`/BE/src/main/resources/application.properties`**
   - 공통 기본 설정
   - JPA/Hibernate 네이밍 전략
   - Swagger 설정
   - FinBERT 엔드포인트

2. **`/BE/src/main/resources/application-dev.properties`**
   - 개발환경 전용 설정
   - 데이터베이스 연결 정보
   - Redis 설정
   - OAuth2 개발용 설정

3. **`/BE/src/main/resources/application-prod.properties`**
   - 운영환경 전용 설정
   - 환경변수 기반 설정
   - 성능 및 보안 최적화
   - KIS API 실제 키 설정

4. **`/.env`**
   - Docker Compose 환경변수
   - 데이터베이스 인증 정보
   - 외부 서비스 API 키

5. **`/docker-compose.yml`**
   - 멀티 서비스 오케스트레이션
   - 네트워크 및 볼륨 설정
   - 환경변수 매핑

#### JPA 엔티티 네이밍 전략
```properties
spring.jpa.hibernate.naming.physical-strategy=org.hibernate.boot.model.naming.PhysicalNamingStrategyStandardImpl
spring.jpa.hibernate.naming.implicit-strategy=org.hibernate.boot.model.naming.ImplicitNamingStrategyJpaCompliantImpl
```

#### 커넥션 풀 설정
```properties
# 개발환경
spring.datasource.hikari.maximum-pool-size=5

# 운영환경
spring.datasource.hikari.maximum-pool-size=10
spring.datasource.hikari.minimum-idle=2
spring.datasource.hikari.connection-timeout=30000
```

### 4.3 주요 계정 정보

#### 데이터베이스 계정
- **운영 계정**: ssafyuser / ssafypw!!
- **권한**: 읽기/쓰기 전체 권한
- **용도**: 애플리케이션 데이터 접근

#### KIS API 계정
- **UserA**: PSXLaNAHtahIBQwCFTBJNGczBiVStg891SM4
- **UserB**: PSs28ViZ7UQIjQsIOOAA5VV4mm0p88OnfCMA
- **용도**: 한국투자증권 실시간 주식 데이터 조회

#### Redis 스트림 설정
- **스트림 키**: orders-stream
- **컨슈머 그룹**: lago_group
- **컨슈머명**: lago_consumer