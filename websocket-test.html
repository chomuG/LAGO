<!DOCTYPE html>
<html>
<head>
    <title>WebSocket STOMP Test</title>
    <script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>
</head>
<body>
    <h1>History Challenge WebSocket Test</h1>
    <p>Check the browser's developer console (F12) for connection status and received messages.</p>
    <div id="messages"></div>

    <script type="text/javascript">
        // Connect to the WebSocket endpoint
        var socket = new SockJS('http://i13d203.p.ssafy.io:8081/ws-stock');
        var stompClient = Stomp.over(socket);

        stompClient.connect({}, function (frame) {
            console.log('Connected: ' + frame);
            document.getElementById('messages').innerHTML += '<p>웹소켓에 연결되었습니다!</p>';

            // 토픽 구독
            stompClient.subscribe('/topic/history-challenge', function (message) {
                console.log('Received Message: ', JSON.parse(message.body));
                var msgBody = JSON.stringify(JSON.parse(message.body), null, 2);
                document.getElementById('messages').innerHTML += '<p>수신된 데이터:</p><pre>' + msgBody + '</pre>';
            });
        }, function(error) {
            console.error('STOMP error: ' + error);
            document.getElementById('messages').innerHTML += '<p style="color: red;">에러: ' + error + '</p>';
        });
    </script>
</body>
</html>
